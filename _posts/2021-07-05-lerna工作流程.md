---
layout: post
read_time: true
show_date: true
title: 'lerna工作流程'
date: 2021-07-05
img: posts/20210705/4.jpg
tags: [cli]
category: opinion
author: 随步
description: 'lerna实践 '
---

#### 为什么使用 lerna

工程化思想的两个维度：1、大幅减少重复操作 2、提升操作的标准化。以效能为核心。

#### 脚手架项目初始化

1、 初始化npm项目
```
mkdir fe-cli && cd fe-cli
npm init -y
```
2、 安装lenrna
```
yarn add lerna -D
```

3、 lerna init 初始化项目
将会在该文件夹下生成 packages文件夹、lerna.json
```
lerna init
```

#### 创建 package

1、lerna create 创建 package
```
lerna create core
```
会在packages下创建名为core的npm包
2、lerna add 安装依赖
```
lerna add react 将会把 react 安装进 packages 下所有的包中
lerna add react packages/core 将会把 react 安装进指定的 packages/包中
https://github.com/lerna/lerna/tree/main/commands/add#readme
```
3、lerna link 链接依赖
完成内部文件的相互依赖，会为你生成软链
```
lrwxr-xr-x  1 liuyan  staff    14B  7  6 16:09 utils -> ../../../utils
```

#### 脚手架开发和测试

1、lerna exec 执行 shell 脚本

可以为你批量执行shell脚本(也可以指定scope)
lerna exec -- rm -rf node_modules/
2、lerna run 执行 npm 命令
lerna run test 批量执行packages中的`test`命令

3、lerna clean 清空依赖
清除 packages 下所有的 node_modules

4、lerna bootstrap 重装依赖
将原本 package.json 中记录的依赖重新安装

#### 脚手架的发布上线

1、lerna version

2、lerna changed
查看哪些包有了改动

3、lerna diff
commit之间的diff对比

4、lerna publish
